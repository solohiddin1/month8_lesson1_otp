<!DOCTYPE html>
<html>
<head>
    <title>{% block title %}App{% endblock %}</title>
</head>
<body>
    <h1>{% block header %}{% endblock %}</h1>
    {% if messages %}
      <ul>
        {% for message in messages %}
          <li>{{ message }}</li>
        {% endfor %}
      </ul>
    {% endif %}
    {% block content %}{% endblock %}

    {% block extra_scripts %}
    <script>
    async function refreshTokenIfNeeded() {
        const refresh = localStorage.getItem("refreshToken");
        if (!refresh) return;

        try {
            const res = await fetch("/api/token/refresh/", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ refresh })
            });
            if (res.ok) {
                const data = await res.json();
                localStorage.setItem("accessToken", data.access);
            } else {
                console.warn("Refresh token invalid or expired");
            }
        } catch (err) {
            console.error(err);
        }
    }

    // Call it periodically, e.g., every 5 minutes
    setInterval(refreshTokenIfNeeded, 5 * 60 * 1000);
    </script>

    
    {% endblock %}
</body>
</html>
